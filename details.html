<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detail View</title>

  <!-- External libraries -->
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdbe-molstar@3.2.0/build/pdbe-molstar-plugin.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pdbe-molstar@3.2.0/build/pdbe-molstar-light.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>
  <script src="https://string-db.org/javascript/combined_embedded_network_v2.0.4.js"></script>
  <script src="https://unpkg.com/cytoscape@3.32.0/dist/cytoscape.min.js"></script>

  <!-- Popper (required by Tippy) -->
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <!-- Tippy tooltip library -->
  <script src="https://unpkg.com/tippy.js@6"></script>
  <!--<link  rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/scale.css">-->
  <link rel="stylesheet"href="https://unpkg.com/tippy.js@6/dist/tippy.css">
  
  <!-- Popper binding for Cytoscape -->
  <script src="https://unpkg.com/cytoscape-popper@2"></script>
  <!-- xz-decompress and other modules -->
  <script src="./js/xzwasm.min.js"></script>
  <script src="./js/util.js"></script>
  <script src="./js/render.js"></script>
  <script src="./js/pae.js"></script>
  <script src="./js/network.js"></script>
  <script src="./js/main.js"></script>

  <style>
    /* Force light background for all Tippy boxes you care about */
    .tippy-box[data-theme~='light'],
    .tippy-box[data-theme~='light-border'] {
      background-color: #fafafa !important;
      color: #0000FF !important;
      font-size  : 16px;
    }
    body {
      font-family: Helvetica, sans-serif;
      width: 90%;
      margin: auto;
    }
    .small-text {
      font-size: 14px;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      /*justify-content: space-between;*/
      justify-content: center;
      gap: 66px;
    }
    .container-small {
      display: flex;
      flex-wrap: wrap;
      /*justify-content: space-between;*/
      gap: 6px;
    }

    .column {
      flex: 1;
      min-width: 0px;
    }

    .small-column {
      flex: 5;
      min-width: 0; /* helps with resizing */
    }

    .large-column {
      flex: 8;
      min-width: 0;
    }

    #PDBeviewer{
      width: 656px;
      height: 400px;
      position: relative;
    }
    #stringEmbedded {
      width: 400px;
      height: 50px;
      position: relative;
      overflow: hidden;
    }
    #stringAppContainer {
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
    }
    #network-container {
      /* Size + spacing */
      width: 656px;
      height: 300px;
      border: 1px solid #d0d0d0;
      border-radius: 6px;
      background: #fafafa;
    }
    #PAEcontainer {
        /*width: 387.096775px;             /* Set width */
        /*height: 300px;            /* Set height */
        width: 418px;             /* Set width */
        height: 336px;            /* Set height */
        border: 1px solid #ccc;   /* Add a light border */
        justify-content: center;  /* Center the figure horizontally */
        align-items: center;      /* Center the figure vertically */
    }
    #profileA, #profileB {
        /*width: 387.096775px;             /* Set width */
        /*height: 300px;            /* Set height */
        width: 418px;             /* Set width */
        height: 306px;            /* Set height */
        border: 1px solid #ccc;   /* Add a light border */
        justify-content: center;  /* Center the figure horizontally */
        align-items: center;      /* Center the figure vertically */
    }
    #paefig {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain; /* Maintain aspect ratio */
        /*
        */
    }
    /* buttons */
    .center-button {
        display: flex;
        justify-content: center;
        padding:0px;
        margin-top: 10px;
    }

    .button-small {
        width: 80px;
        padding: 6px;
        text-align: left;
        margin: 5px 5px;
    }
    .button-medium {
        width: 280px;
        padding: 5px;
        text-align: left;
        margin: 1px 1px;
    }
    .button-large {
        width: 392px;
        padding: 1px;
        text-align: left;
        margin: 5px 5px;
    }
    .back-button {
        display: inline-block;
        margin-bottom: 5px;
        padding: 5px 5px;
        font-size: 16px;
        color: #fff;
        background-color: #007bff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
    }
    .back-button:hover {
        background-color: #0056b3;
    }
    /* add a footer to declair copy right information */
    footer {
      /*background-color: #333;
      color: white;*/
      text-align: center;
      padding: 10px 0;
      position: relative;
      bottom: 0;
      width: 100%;
      font-size: 14px;
    }
    footer a {
      color: #ffb74d;
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
    html {
      scroll-behavior: smooth;
    }

    /* for small screen smart device */
    @media (max-width: 767px) {

      .container,
      .container-small {
        flex-direction: column;
        align-items: stretch;
        gap: 20px;
      }

      .column,
      .small-column,
      .large-column {
        flex: 1 1 100%;
        min-width: 0;
      }

      h2 { font-size: 1.6rem; }
      h3 { font-size: 1.3rem; }
    }
    h2, h3, a, p { word-break: break-word; }

    @media (max-width: 767px) {
      html {
        /* shrink the whole page to ~70 % */
        transform: scale(0.7);
        transform-origin: top left;
        width: 143%;              /* 1 / 0.7 → prevent horizontal scrollbar */
      }
    }
  </style>
</head>
<body>
  <h2>Details for ID: <span id="entry-id"></span></h2>
  <h3>Protein Details</h3>
  <p>Protein A: <span id="proteinA"></span>, <span id="geneA"></span>, <span id="annotationA"></span></p>
  <p>Protein B: <span id="proteinB"></span>, <span id="geneB"></span>, <span id="annotationB"></span></p>
  <h3>Prediction Detail</h3>
  <p>iptm: <span id="iptm"></span>, PAE: <span id="pae"></span>, pDockQ: <span id="pdockq"></span>, confidence of interaction: <span id="ppi"></span></p>
  <br>
  <div class="container">

    <!--Structure Column-->
    <div class="large-column">
      <h3>AF2 Model</h3>
      <div id="PDBeviewer"></div>
      <h3> Click below to show Interface </h3>
      <div class="container-small">
        <!--<div class="column">-->
          <button class="button-medium" id="selectChainA">
            Interface in Protein A (<span id="geneAbutton"></span>): <br><span id="interfaceA"></span>
          </button>
        <!--</div>-->
        <!--
        <div class="column">
        -->
          <button class="button-medium" id="selectChainB">
            Interface in Protein B (<span id="geneBbutton"></span>): <br><span id="interfaceB"></span>
          </button>
        <!--
        </div>
        -->
        <!--
      </div>
      <div class="center-button">
        -->
        <button class="button-small" id="clearselection">Clear Selection</button>
        <!--
      </div>
        -->
      </div>
      <!-- Interaction network (A—B + highconf partners) -->
      <br>
      <h3>Position in predicted high confidence PPI Network</h3>
      <p>Note it is <span id="ppiNet"></span></p>
      <div id="network-container"></div>
      <br>
      <h3>STRING Network</h3>
      <p>click the logo to check details in the version 11.5 STRING database</p>
      <!--<div id="stringEmbedded"> <div id="stringAppContainer"></div> </div>-->
      <div id="stringEmbedded"> <div>id="stringNetworkImage"></div> </div>
      <br><a id="modelpath" href="#" download>Download the model</a>
      <br><br>
    </div>
    <!--End of Structure Column-->

    <!--PAE session-->
    <div class="small-column">
      <h3>Predicted Aligned Error</h3>
      <!--<div id="PAEcontainer"><img id="paefig" style="width: 100%; height: 100%; object-fit: contain;"></div>-->
      <div id="PAEcontainer"><div id="paefig" style="width:100%; height:600px;"></div></div>
      <h3>Protein A (<span id="geneA_IF"></span>) interface binding mode(s)</h3>
      <div id="profileA"></div>
      <h3>Protein B (<span id="geneB_IF"></span>) interface binding mode(s)</h3>
      <div id="profileB"></div>
      <p>IF(IDR): disordered binding<br>IF(CF): conditionally folded binding<br>IF(coil2order): coil-to-order binding<br>IF(order): ordered interface</p>
      <p id="profileNote" class="muted" style="display:none;"></p>
    </div>
    <!--End of PAE session-->

  </div>

  <a href="index.html" class="back-button">Back to List</a>

  <script>
    const id = new URLSearchParams(window.location.search).get("id");
    document.getElementById("entry-id").textContent = id;
    //document.getElementById("modelpath").href = `./data/pdb/${id}.pdb`;
    document.getElementById('modelpath').href = `https://storage.googleapis.com/dmelppi_web/mpdb/${id}.pdb.gz`;
    //document.getElementById("paefig").src = `https://storage.googleapis.com/dmelppi_web/mPAE/${id}_pae.jpg`;
    //document.getElementById("paefig").src = `./data/link_not_activated.png`;
    ViewStructure(id);
  </script>

  <!-- Footer -->
  <footer>
    &copy; 2024-<span id="currentYear"></span> Zhao Lab at Rockefeller University | Designed by Junhui Peng and Zhao Lab
  </footer>
  <script>
    // Set the current year dynamically
    document.getElementById("currentYear").textContent = new Date().getFullYear();
  </script>
</body>
</html>
